<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ᵣ₂ᵥ₄</title>
  <!-- Prefer system Frutiger if available, otherwise load a Frutiger-like webfont (Source Sans 3) -->
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Local font-face rules: place font files under /assets/fonts/ and they'll be used when available.
       Expected filenames (examples):
         - assets/fonts/Frutiger.woff2
         - assets/fonts/SourceSans3-Regular.woff2
       These are optional — browser will fall back to the web/system stack if missing. */
    @font-face{
      font-family: 'LocalFrutiger';
      src: url('/assets/fonts/Frutiger.woff2') format('woff2'), url('/assets/fonts/Frutiger.woff') format('woff');
      font-weight: 100 900;
      font-style: normal;
      font-display: swap;
    }
    @font-face{
      font-family: 'LocalSourceSans3';
      src: url('/assets/fonts/SourceSans3-Regular.woff2') format('woff2'), url('/assets/fonts/SourceSans3-Regular.woff') format('woff');
      font-weight: 100 900;
      font-style: normal;
      font-display: swap;
    }
    /* ---------------- Reset & variables ---------------- */
    *, *::before, *::after { box-sizing: border-box; }
    :root{
      --bg: #fbfbfb;
      --card: #ffffff;
      --muted: #6b7280;
      --text: #0f172a;
      --accent: #111827;
      --toggle-bg-alpha: 0.03;
      --radius: 10px;
      --max-width: 920px;
      --gap: 20px;
    }

    /* Frutiger-like typography stack: prefer local Frutiger, fall back to Source Sans 3/Inter */
    body {
      margin: 0;
      /* Prefer local fonts if provided in /assets/fonts/ */
      font-family: "LocalFrutiger", "LocalSourceSans3", "Frutiger", "Source Sans 3", Inter, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.55;
      font-size: 16px;
    }

  /* ---------------- Top toggle button ---------------- */
    #toggleBtn {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 1001;
      background: rgba(17,24,39,var(--toggle-bg-alpha));
      color: var(--accent);
      border: 1px solid rgba(15,23,42,0.06);
      padding: 10px 12px;
      font-size: 1.05rem;
      cursor: pointer;
      border-radius: 8px;
      transition: background .18s, transform .08s;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
    }
    #toggleBtn:hover { background: rgba(17,24,39,0.06); transform: translateY(-1px); }
    #toggleBtn img{ display:block; width:20px; height:20px; object-fit:contain; }

    /* ---------------- Sidebar (top) ---------------- */
    #topSidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--card);
      color: var(--text);
      padding: 56px 18px 20px;
      transform: translate3d(0,-110%,0);
      transition: transform .36s cubic-bezier(.2,.9,.2,1), opacity .28s linear;
      will-change: transform, opacity;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(15,23,42,0.08);
      border-bottom: 1px solid rgba(15,23,42,0.03);
    }
    #topSidebar.open { transform: translateY(0); }
    #topSidebar.open{ opacity: 1; }
    #topSidebar{ opacity: 0.98; }

    /* Close button inside sidebar */
    #closeBtn{
      position: absolute;
      top: 14px;
      right: 14px;
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 1.25rem;
      cursor: pointer;
    }

    /* Sidebar links (centered, airy) */
    #topSidebar ul{
      list-style: none;
      padding: 0;
      margin: 8px auto 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
      justify-content: center;
      align-items: center;
    }
    #topSidebar ul li a{
      color: var(--accent);
      text-decoration: none;
      font-size: 1.05rem;
      padding: 8px 12px;
      border-radius: 8px;
      transition: background .14s, color .14s;
    }
    #topSidebar ul li a:hover{ background: rgba(17,24,39,0.04); color: var(--text); }

    /* ---------------- Main content (demo) ---------------- */
    main{
      padding: 96px 20px 40px;
      max-width: var(--max-width);
      margin: 0 auto;
    }
    main > * { margin-bottom: 1.25rem; }
    main h1{
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.01em;
      margin: 0 0 .5rem 0;
    }
    main h2{
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0 0 .5rem 0;
      color: var(--accent);
    }
    main p{ color: var(--muted); margin: 0; }

    /* Slightly lift content on light background for Frutiger-like clarity */
    .content-card{
      background: var(--card);
      padding: 28px;
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(15,23,42,0.04);
      border: 1px solid rgba(15,23,42,0.02);
    }

    /* Responsive adjustments */
    @media (min-width: 720px){
      #topSidebar { padding: 64px 24px 28px; }
      main { padding-top: 120px; }
    }
    /* ---------------- Settings panel ---------------- */
    #settingsBtn{
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 1001;
      background: rgba(17,24,39,0.03);
      color: var(--accent);
      border: 1px solid rgba(15,23,42,0.06);
      padding: 8px 10px;
      font-size: 1.05rem;
      cursor: pointer;
      border-radius: 8px;
      transition: background .18s, transform .08s;
    }
    #settingsBtn:hover{ background: rgba(17,24,39,0.06); transform: translateY(-1px); }
    #settingsBtn img{ display:block; width:18px; height:18px; object-fit:contain; }

    #settingsPanel{
      position: fixed;
      top: 0;
      right: 0;
      height: 100%;
      width: min(420px, 90vw);
      background: var(--card);
      box-shadow: -8px 0 24px rgba(15,23,42,0.08);
      transform: translate3d(110%,0,0);
      transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .24s linear;
      will-change: transform, opacity;
      z-index: 1200;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    /* scrollable inner area so panel can scroll when content is long */
    .settings-inner{
      flex: 1 1 auto;
      overflow: auto;
      padding-right: 6px; /* for comfortable scrolling */
      -webkit-overflow-scrolling: touch;
    }
    /* top floating close button inside the panel */
    #settingsCloseTop{
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 1300;
      background: rgba(17,24,39,0.04);
      border: 1px solid rgba(15,23,42,0.06);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    #settingsPanel.open{ transform: translateX(0); }
    #settingsPanel{ opacity: 0.99; }
    #settingsPanel h3{ margin: 0; font-size: 1.05rem; font-weight: 600; }
    .settings-row{ display:flex; gap:10px; align-items:center; }
    .settings-row label{ flex:0 0 110px; color:var(--muted); font-size:0.95rem; }
  .settings-row input[type="text"]{ flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); }
  .settings-row input[type="range"]{ width:160px; }
  .icon-preview{ width:48px; height:48px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); display:flex; align-items:center; justify-content:center; overflow:hidden; background:rgba(0,0,0,0.02); }
  .icon-preview img{ width:100%; height:100%; object-fit:cover; }
    .settings-actions{ margin-top: auto; display:flex; gap:8px; }
    .btn{ padding:8px 12px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); background:rgba(17,24,39,0.03); cursor:pointer; }
    .btn.primary{ background: var(--accent); color:#fff; border-color:transparent; }
    .bg-preview{ height:120px; border-radius:8px; background-size:cover; background-position:center; border:1px solid rgba(15,23,42,0.04); }
    /* make buttons semi-transparent by default, full on hover */
    button, .btn, #toggleBtn, #settingsBtn, #closeBtn, #settingsCloseTop {
      opacity: 0.5;
      transition: opacity .12s ease;
    }
    button:hover, .btn:hover, #toggleBtn:hover, #settingsBtn:hover, #settingsCloseTop:hover {
      opacity: 1;
    }
    /* Top sidebar submenu styles */
    .nav-item { margin-bottom: 6px; }
    .nav-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: rgba(17,24,39,var(--toggle-bg-alpha));
      color: var(--accent);
      border-radius: 8px;
      border: 1px solid rgba(15,23,42,0.06);
      cursor: pointer;
      width: 100%;
      text-align: left;
      font-weight: 600;
      font-family: inherit;
      -webkit-tap-highlight-color: transparent;
      transition: background .18s, transform .08s, opacity .12s;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
      font-size: 1.05rem;
    }
    .nav-toggle:hover{ background: rgba(17,24,39,0.06); transform: translateY(-1px); }
    .nav-toggle[aria-expanded="true"]{ background: rgba(17,24,39,0.06); }
    .nav-toggle:focus, .nav-toggle:focus-visible { outline: none !important; box-shadow: none !important; }

    /* Smooth, hardware-accelerated submenu animation using scaleY + opacity */
    .submenu{
      transform-origin: top center;
      transform: scaleY(0);
      transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .22s ease;
      opacity: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0 12px 0;
      will-change: transform, opacity;
      pointer-events: none;
    }
    .nav-item.expanded .submenu{
      transform: scaleY(1);
      opacity: 1;
      pointer-events: auto;
    }
    /* match top sidebar link style so sublinks look identical */
    .submenu a{
      display: inline-flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 8px;
      text-decoration: none;
      color: var(--accent);
      background: rgba(0,0,0,0.02);
      border: 1px solid rgba(15,23,42,0.02);
      font-size: 1.05rem;
      font-weight: 600;
      line-height: 1.2;
      font-family: inherit;
      transition: background .14s, color .14s;
    }
    /* Button style variants (controlled by data attribute on :root) */
    :root[data-button-style="default"] .btn{ border-radius:8px; box-shadow:0 1px 0 rgba(0,0,0,0.02); }
    :root[data-button-style="flat"] .btn{ border-radius:6px; box-shadow:none; background: transparent; border:1px solid rgba(15,23,42,0.06); }
    :root[data-button-style="pill"] .btn{ border-radius:999px; padding-left:14px; padding-right:14px; }
    .submenu a:hover{ background: rgba(17,24,39,0.04); }
  </style>
  <!-- favicon link that can be updated dynamically -->
  <link id="faviconLink" rel="icon" href="assets/favicon.svg">
</head>
<body>
  <!-- Toggle button (always visible) -->
  <button id="toggleBtn" aria-pressed="false"><img id="toggleIcon" alt="menu icon"></button>
  <!-- Settings button -->
  <button id="settingsBtn"><img id="settingsIcon" alt="settings icon"></button>

  <!-- Top sidebar -->
  <nav id="topSidebar" aria-hidden="true">
    <button id="closeBtn">✕</button>
    <ul>
      <li class="nav-item">
        <button id="navHome" class="nav-toggle" aria-expanded="false" data-i18n="home">ホーム</button>
        <div class="submenu" aria-hidden="true">
          <a id="navHomeOverview" href="#home" data-i18n="homeOverview">概要</a>
          <a id="navHomeFeatures" href="#home-features" data-i18n="homeFeatures">機能</a>
        </div>
      </li>
      <li class="nav-item">
        <button id="navAbout" class="nav-toggle" aria-expanded="false" data-i18n="about">について</button>
        <div class="submenu" aria-hidden="true">
          <a id="navAboutTeam" href="#team" data-i18n="aboutTeam">チーム</a>
          <a id="navAboutHistory" href="#history" data-i18n="aboutHistory">歴史</a>
        </div>
      </li>
      <li class="nav-item">
        <button id="navServices" class="nav-toggle" aria-expanded="false" data-i18n="services">サービス</button>
        <div class="submenu" aria-hidden="true">
          <a id="navServicesConsulting" href="#consulting" data-i18n="servicesConsulting">コンサルティング</a>
          <a id="navServicesDevelopment" href="#development" data-i18n="servicesDevelopment">開発</a>
        </div>
      </li>
      <li class="nav-item">
        <button id="navPortfolio" class="nav-toggle" aria-expanded="false" data-i18n="portfolio">ポートフォリオ</button>
        <div class="submenu" aria-hidden="true">
          <a id="navPortfolioProjects" href="#projects" data-i18n="portfolioProjects">プロジェクト</a>
          <a id="navPortfolioCaseStudies" href="#case-studies" data-i18n="portfolioCaseStudies">ケーススタディ</a>
        </div>
      </li>
      <li class="nav-item">
        <button id="navContact" class="nav-toggle" aria-expanded="false" data-i18n="contact">お問い合わせ</button>
        <div class="submenu" aria-hidden="true">
          <a id="navContactGetInTouch" href="#contact-form" data-i18n="contactGetInTouch">ご連絡</a>
          <a id="navContactLocations" href="#locations" data-i18n="contactLocations">拠点</a>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Demo content -->
  <main>
  <h1 id="mainTitle" data-i18n="homeTitle">ようこそ</h1>

  <section id="home"><h2>ホーム</h2></section>
  </main>

  <!-- Settings panel (slide-in) -->
  <aside id="settingsPanel" aria-hidden="true">
    <h3>設定</h3>
    <p style="margin:0;color:var(--muted);font-size:0.95rem;">サイトの外観をカスタマイズします。背景の変更はこのブラウザに保存されます。</p>

    <button id="settingsCloseTop" class="btn">✕</button>

    <div class="settings-inner">
      <!-- language selector removed -->

    <hr style="border:none;border-top:1px solid rgba(15,23,42,0.04);margin:6px 0;">

    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;" data-i18n="theme">テーマ</div>
      <div class="settings-row">
        <label for="textColor" data-i18n="textColor">テキスト色</label>
        <input id="textColor" type="color" value="#0f172a">
      </div>
      <div class="settings-row">
        <label for="accentColor" data-i18n="accentColor">アクセント色</label>
        <input id="accentColor" type="color" value="#111827">
      </div>
      <div class="settings-row">
        <label for="buttonStyle" data-i18n="buttonStyle">ボタンスタイル</label>
        <select id="buttonStyle">
          <option value="default">デフォルト</option>
          <option value="flat">フラット</option>
          <option value="pill">ピル型</option>
        </select>
      </div>
      <div class="settings-row">
        <label for="fontSelect" data-i18n="font">フォント</label>
        <select id="fontSelect">
          <option value="Frutiger, 'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial">Frutiger / Source Sans</option>
          <option value="'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial">Source Sans 3</option>
          <option value="Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial">Inter</option>
          <option value="Georgia, 'Times New Roman', Times, serif">セリフ (Georgia)</option>
        </select>
      </div>
      <div class="settings-row">
      <label for="bgUrl" data-i18n="bgUrl">画像URL</label>
      <input id="bgUrl" type="text" placeholder="https://.../image.jpg">
    </div>

    <div class="settings-row">
      <label for="toggleOpacity" data-i18n="menuOpacity">メニュー不透明度</label>
      <input id="toggleOpacity" type="range" min="0" max="1" step="0.01" value="0.03">
      <div style="width:48px;text-align:right;color:var(--muted);font-size:0.95rem;" id="toggleOpacityVal">0.03</div>
    </div>

    <div class="settings-row">
      <label for="bgFile" data-i18n="upload">アップロード</label>
      <input id="bgFile" type="file" accept="image/*">
    </div>

    <hr style="border:none;border-top:1px solid rgba(15,23,42,0.04);margin:6px 0;">

    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;" data-i18n="favicon">ファビコン</div>
    <div class="settings-row">
      <label for="faviconUrl" data-i18n="faviconUrlLabel">ファビコンURL</label>
      <input id="faviconUrl" type="text" placeholder="https://.../favicon.ico">
      <div class="icon-preview" id="faviconPreview"><img alt="favicon preview" id="faviconPreviewImg"></div>
    </div>
    <div class="settings-row">
      <label for="faviconFile" data-i18n="bgFileLabel">アップロード</label>
      <input id="faviconFile" type="file" accept="image/*">
    </div>

    <div class="settings-row">
      <label for="siteTitle" data-i18n="siteTitle">サイトタイトル</label>
      <input id="siteTitle" type="text" placeholder="サイトタイトル">
    </div>

    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;" data-i18n="titlePresets">タイトルプリセット</div>
    <div id="titlePresets" style="display:flex;gap:8px;flex-wrap:wrap;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);"></div>

    <hr style="border:none;border-top:1px solid rgba(15,23,42,0.04);margin:6px 0;">

    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;" data-i18n="icons">アイコン</div>

    <div class="settings-row">
      <label for="toggleIconUrl" data-i18n="menuIcon">メニューアイコンURL</label>
      <input id="toggleIconUrl" type="text" placeholder="https://.../icon.png">
      <div class="icon-preview" id="toggleIconPreview"><img alt="menu preview" id="toggleIconPreviewImg"></div>
    </div>

    <div class="settings-row">
      <label for="toggleIconFile" data-i18n="toggleIconFileLabel">アップロード</label>
      <input id="toggleIconFile" type="file" accept="image/*">
    </div>

    <div class="settings-row">
      <label for="settingsIconUrl" data-i18n="settingsIcon">設定アイコンURL</label>
      <input id="settingsIconUrl" type="text" placeholder="https://.../icon.png">
      <div class="icon-preview" id="settingsIconPreview"><img alt="settings preview" id="settingsIconPreviewImg"></div>
    </div>

    <div class="settings-row">
      <label for="settingsIconFile" data-i18n="settingsIconFileLabel">アップロード</label>
      <input id="settingsIconFile" type="file" accept="image/*">
    </div>

    <div class="settings-row">
      <label data-i18n="preview">プレビュー</label>
      <div id="bgPreview" class="bg-preview" aria-hidden="true"></div>
    </div>

    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;" data-i18n="presetIcons">プリセットアイコン</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:220px;">
        <div style="font-size:0.95rem;color:var(--muted);margin-bottom:6px;" data-i18n="menuPresets">メニュープリセット</div>
        <div id="menuPresets" style="display:flex;gap:8px;flex-wrap:wrap;
          background:transparent;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);
        "></div>
      </div>
      <div style="flex:1;min-width:220px;">
        <div style="font-size:0.95rem;color:var(--muted);margin-bottom:6px;" data-i18n="settingsPresets">設定プリセット</div>
        <div id="settingsPresets" style="display:flex;gap:8px;flex-wrap:wrap;
          background:transparent;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);
        "></div>
      </div>
    </div>

      <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;" data-i18n="faviconPresets">ファビコンプリセット</div>
      <div id="faviconPresets" style="display:flex;gap:8px;flex-wrap:wrap;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);"></div>

      <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;" data-i18n="backgroundPresets">背景プリセット</div>
      <div id="bgPresets" style="display:flex;gap:8px;flex-wrap:wrap;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);"></div>
      
    <hr style="border:none;border-top:1px solid rgba(15,23,42,0.04);margin:6px 0;">
    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;">ナビゲーション (Navigation)</div>
    <div style="font-size:0.95rem;color:var(--muted);margin:6px 0;">トップバーのラベルとリンクをここで編集できます。</div>
    <div id="navEditor" style="display:flex;flex-direction:column;gap:8px;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);">
      <!-- Home -->
      <div class="settings-row">
        <label for="nav_home_label">Home label</label>
        <input id="nav_home_label" type="text" placeholder="Home">
      </div>
      <div class="settings-row">
        <label for="nav_home_sub1_label">Home sub1</label>
        <input id="nav_home_sub1_label" type="text" placeholder="Overview">
        <input id="nav_home_sub1_url" type="text" placeholder="#home">
      </div>
      <div class="settings-row">
        <label for="nav_home_sub2_label">Home sub2</label>
        <input id="nav_home_sub2_label" type="text" placeholder="Features">
        <input id="nav_home_sub2_url" type="text" placeholder="#home-features">
      </div>
      <!-- About -->
      <div class="settings-row">
        <label for="nav_about_label">About label</label>
        <input id="nav_about_label" type="text" placeholder="About">
      </div>
      <div class="settings-row">
        <label for="nav_about_sub1_label">About sub1</label>
        <input id="nav_about_sub1_label" type="text" placeholder="Team">
        <input id="nav_about_sub1_url" type="text" placeholder="#team">
      </div>
      <div class="settings-row">
        <label for="nav_about_sub2_label">About sub2</label>
        <input id="nav_about_sub2_label" type="text" placeholder="History">
        <input id="nav_about_sub2_url" type="text" placeholder="#history">
      </div>
      <!-- Services -->
      <div class="settings-row">
        <label for="nav_services_label">Services label</label>
        <input id="nav_services_label" type="text" placeholder="Services">
      </div>
      <div class="settings-row">
        <label for="nav_services_sub1_label">Services sub1</label>
        <input id="nav_services_sub1_label" type="text" placeholder="Consulting">
        <input id="nav_services_sub1_url" type="text" placeholder="#consulting">
      </div>
      <div class="settings-row">
        <label for="nav_services_sub2_label">Services sub2</label>
        <input id="nav_services_sub2_label" type="text" placeholder="Development">
        <input id="nav_services_sub2_url" type="text" placeholder="#development">
      </div>
      <!-- Portfolio -->
      <div class="settings-row">
        <label for="nav_portfolio_label">Portfolio label</label>
        <input id="nav_portfolio_label" type="text" placeholder="Portfolio">
      </div>
      <div class="settings-row">
        <label for="nav_portfolio_sub1_label">Portfolio sub1</label>
        <input id="nav_portfolio_sub1_label" type="text" placeholder="Projects">
        <input id="nav_portfolio_sub1_url" type="text" placeholder="#projects">
      </div>
      <div class="settings-row">
        <label for="nav_portfolio_sub2_label">Portfolio sub2</label>
        <input id="nav_portfolio_sub2_label" type="text" placeholder="Case studies">
        <input id="nav_portfolio_sub2_url" type="text" placeholder="#case-studies">
      </div>
      <!-- Contact -->
      <div class="settings-row">
        <label for="nav_contact_label">Contact label</label>
        <input id="nav_contact_label" type="text" placeholder="Contact">
      </div>
      <div class="settings-row">
        <label for="nav_contact_sub1_label">Contact sub1</label>
        <input id="nav_contact_sub1_label" type="text" placeholder="Get in touch">
        <input id="nav_contact_sub1_url" type="text" placeholder="#contact-form">
      </div>
      <div class="settings-row">
        <label for="nav_contact_sub2_label">Contact sub2</label>
        <input id="nav_contact_sub2_label" type="text" placeholder="Locations">
        <input id="nav_contact_sub2_url" type="text" placeholder="#locations">
      </div>
    </div>
    <hr style="border:none;border-top:1px solid rgba(15,23,42,0.04);margin:6px 0;">
    <div style="font-weight:600;color:var(--muted);font-size:0.95rem;margin-top:8px;">Label Editor</div>
    <div id="labelEditor" style="display:flex;flex-direction:column;gap:8px;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.03);">
      <div class="settings-row">
        <label for="lbl_save_label">Save button</label>
        <input id="lbl_save_label" type="text" placeholder="Save">
      </div>
      <div class="settings-row">
        <label for="lbl_reset_label">Reset button</label>
        <input id="lbl_reset_label" type="text" placeholder="Reset">
      </div>
      <div class="settings-row">
        <label for="lbl_close_label">Close button</label>
        <input id="lbl_close_label" type="text" placeholder="Close">
      </div>
    </div>
    </div> <!-- .settings-inner -->

    <div class="settings-actions">
      <button id="saveSettings" class="btn primary">保存</button>
      <button id="clearSettings" class="btn">リセット</button>
      <button id="closeSettings" class="btn">閉じる</button>
    </div>
  </aside>

  <script>
    // translation system removed. default static labels are used and navigation labels are editable via settings.
    // Apply UI labels and nav links from stored settings or defaults
    const DEFAULT_NAV = {
      home: { label: 'Home', url: '#home', subs: [{label:'Overview', url:'#home'}, {label:'Features', url:'#home-features'}] },
      about: { label: 'About', url: '#about', subs: [{label:'Team', url:'#team'}, {label:'History', url:'#history'}] },
      services: { label: 'Services', url: '#services', subs: [{label:'Consulting', url:'#consulting'}, {label:'Development', url:'#development'}] },
      portfolio: { label: 'Portfolio', url: '#portfolio', subs: [{label:'Projects', url:'#projects'}, {label:'Case studies', url:'#case-studies'}] },
      contact: { label: 'Contact', url: '#contact-form', subs: [{label:'Get in touch', url:'#contact-form'}, {label:'Locations', url:'#locations'}] },
    };

    function applyLabels(){
      // load settings nav from localStorage (if any)
      let cfg = {};
      try{ cfg = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}') || {}; }catch(e){ cfg = {}; }
      const navCfg = (cfg.nav) ? cfg.nav : DEFAULT_NAV;
      // apply main title
      const h1 = document.querySelector('main h1');
      if(h1 && cfg.title) h1.textContent = cfg.title; else if(h1) h1.textContent = DEFAULT_NAV.home.label;
      // apply nav labels and hrefs
      const map = ['home','about','services','portfolio','contact'];
      map.forEach(key => {
        const item = navCfg[key] || DEFAULT_NAV[key];
        const btn = document.getElementById('nav' + key[0].toUpperCase() + key.slice(1));
        if(btn && item) btn.textContent = item.label || DEFAULT_NAV[key].label;
        const submenu = document.getElementById('nav' + key[0].toUpperCase() + key.slice(1)); // not used for hrefs
        // apply links for subitems
        try{
          const container = document.querySelector('#' + 'nav' + key[0].toUpperCase() + key.slice(1) + ' ~ .submenu');
        }catch(e){}
      });
      // quick pass for each submenu link by known ids
      ['Home','About','Services','Portfolio','Contact'].forEach((name, idx) => {
        const key = map[idx];
        const item = navCfg[key] || DEFAULT_NAV[key];
        // top-level link is button (no href), but sublinks have specific ids
        if(item && item.subs){
          item.subs.forEach((s, i) => {
            const subEl = document.getElementById(`nav${key[0].toUpperCase() + key.slice(1)}${i===0? (key==='home'?'Overview': (key==='about'?'Team':'Consulting')) : (i===1? (key==='home'?'Features': (key==='about'?'History':'Development')) : '')}`);
            // fallback to known ids we created earlier
          });
        }
      });
      // apply hrefs for submenu items using explicit IDs
      // Home
      const navHomeOverview = document.getElementById('navHomeOverview'); if(navHomeOverview){ navHomeOverview.href = (navCfg.home && navCfg.home.subs && navCfg.home.subs[0] && navCfg.home.subs[0].url) || '#home'; }
      const navHomeFeatures = document.getElementById('navHomeFeatures'); if(navHomeFeatures){ navHomeFeatures.href = (navCfg.home && navCfg.home.subs && navCfg.home.subs[1] && navCfg.home.subs[1].url) || '#home-features'; }
      // About
      const navAboutTeam = document.getElementById('navAboutTeam'); if(navAboutTeam){ navAboutTeam.href = (navCfg.about && navCfg.about.subs && navCfg.about.subs[0] && navCfg.about.subs[0].url) || '#team'; }
      const navAboutHistory = document.getElementById('navAboutHistory'); if(navAboutHistory){ navAboutHistory.href = (navCfg.about && navCfg.about.subs && navCfg.about.subs[1] && navCfg.about.subs[1].url) || '#history'; }
      // Services
      const navServicesConsulting = document.getElementById('navServicesConsulting'); if(navServicesConsulting){ navServicesConsulting.href = (navCfg.services && navCfg.services.subs && navCfg.services.subs[0] && navCfg.services.subs[0].url) || '#consulting'; }
      const navServicesDevelopment = document.getElementById('navServicesDevelopment'); if(navServicesDevelopment){ navServicesDevelopment.href = (navCfg.services && navCfg.services.subs && navCfg.services.subs[1] && navCfg.services.subs[1].url) || '#development'; }
      // Portfolio
      const navPortfolioProjects = document.getElementById('navPortfolioProjects'); if(navPortfolioProjects){ navPortfolioProjects.href = (navCfg.portfolio && navCfg.portfolio.subs && navCfg.portfolio.subs[0] && navCfg.portfolio.subs[0].url) || '#projects'; }
      const navPortfolioCaseStudies = document.getElementById('navPortfolioCaseStudies'); if(navPortfolioCaseStudies){ navPortfolioCaseStudies.href = (navCfg.portfolio && navCfg.portfolio.subs && navCfg.portfolio.subs[1] && navCfg.portfolio.subs[1].url) || '#case-studies'; }
      // Contact
      const navContactGetInTouch = document.getElementById('navContactGetInTouch'); if(navContactGetInTouch){ navContactGetInTouch.href = (navCfg.contact && navCfg.contact.subs && navCfg.contact.subs[0] && navCfg.contact.subs[0].url) || '#contact-form'; }
      const navContactLocations = document.getElementById('navContactLocations'); if(navContactLocations){ navContactLocations.href = (navCfg.contact && navCfg.contact.subs && navCfg.contact.subs[1] && navCfg.contact.subs[1].url) || '#locations'; }
      // set aria-labels to sensible defaults
      const tBtn = document.getElementById('toggleBtn'); if(tBtn) tBtn.setAttribute('aria-label', 'Open menu');
      const sBtn = document.getElementById('settingsBtn'); if(sBtn) sBtn.setAttribute('aria-label', 'Open settings');
      const cBtn = document.getElementById('closeBtn'); if(cBtn) cBtn.setAttribute('aria-label', 'Close menu');
      const scTop = document.getElementById('settingsCloseTop'); if(scTop) scTop.setAttribute('aria-label', 'Close settings');
      // alt texts
      if(toggleIconEl) toggleIconEl.alt = 'menu icon';
      if(settingsIconEl) settingsIconEl.alt = 'settings icon';
      if(faviconPreviewImg) faviconPreviewImg.alt = 'favicon preview';
    }
      // Legacy text update logic removed, applyLabels() manages nav & text
    const toggleBtn = document.getElementById('toggleBtn');
    const closeBtn   = document.getElementById('closeBtn');
    const sidebar    = document.getElementById('topSidebar');

    function openSidebar() {
      sidebar.classList.add('open');
      sidebar.setAttribute('aria-hidden', 'false');
      toggleBtn.setAttribute('aria-pressed', 'true');
      if(toggleBtn) toggleBtn.setAttribute('aria-label', 'Close menu');
    }

    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebar.setAttribute('aria-hidden', 'true');
      toggleBtn.setAttribute('aria-pressed', 'false');
      if(toggleBtn) toggleBtn.setAttribute('aria-label', 'Open menu');
    }

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.contains('open') ? closeSidebar() : openSidebar();
    });

    closeBtn.addEventListener('click', closeSidebar);

    // Optional: close when clicking a link (mobile friendliness)
    sidebar.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', closeSidebar);
    });

    // Expandable submenu behavior for top sidebar
    (function setupSubmenus(){
      const toggles = sidebar.querySelectorAll('.nav-toggle');
      toggles.forEach(btn => {
        btn.addEventListener('click', (e) => {
          const li = btn.closest('.nav-item');
          if(!li) return;
          const expanded = li.classList.toggle('expanded');
          btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
          const submenu = li.querySelector('.submenu');
          if(submenu) submenu.setAttribute('aria-hidden', expanded ? 'false' : 'true');
        });
      });
    })();

    /* ---------------- Settings behavior ---------------- */
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const closeSettings = document.getElementById('closeSettings');
    const saveSettings = document.getElementById('saveSettings');
    const clearSettings = document.getElementById('clearSettings');

    // storage + defaults
  const STORAGE_KEY = 'site:settings';
  let DEFAULT_TOGGLE_ICON = 'assets/menu.svg';
  let DEFAULT_SETTINGS_ICON = 'assets/settings.svg';
  let DEFAULT_FAVICON = 'assets/favicon.svg';

    // capture initial title so reset can restore
    const INITIAL_TITLE = document.title;
    const faviconLink = document.getElementById('faviconLink');

    // UI elements
    const bgUrlInput = document.getElementById('bgUrl');
    const bgFileInput = document.getElementById('bgFile');
    const bgPreview = document.getElementById('bgPreview');

    const faviconUrl = document.getElementById('faviconUrl');
    const faviconFile = document.getElementById('faviconFile');
    const faviconPreviewImg = document.getElementById('faviconPreviewImg');

    const toggleIconEl = document.getElementById('toggleIcon');
    const settingsIconEl = document.getElementById('settingsIcon');
    const toggleIconUrl = document.getElementById('toggleIconUrl');
    const toggleIconFile = document.getElementById('toggleIconFile');
    const textColorInput = document.getElementById('textColor');
    const accentColorInput = document.getElementById('accentColor');
    const buttonStyleSelect = document.getElementById('buttonStyle');
    const fontSelect = document.getElementById('fontSelect');
    // language selector removed
    const siteTitleInput = (function(){ try{return document.getElementById('siteTitle')}catch(e){return null;} })();
    const titlePresetsContainer = (function(){ try{return document.getElementById('titlePresets')}catch(e){return null;} })();
    const toggleIconPreviewImg = document.getElementById('toggleIconPreviewImg');
    const settingsIconUrl = document.getElementById('settingsIconUrl');
    const settingsIconFile = document.getElementById('settingsIconFile');
    const settingsIconPreviewImg = document.getElementById('settingsIconPreviewImg');
    // Label editor inputs
    const lbl_save_label = document.getElementById('lbl_save_label');
    const lbl_reset_label = document.getElementById('lbl_reset_label');
    const lbl_close_label = document.getElementById('lbl_close_label');
    // Nav editor inputs
    const nav_home_label = document.getElementById('nav_home_label');
    const nav_home_sub1_label = document.getElementById('nav_home_sub1_label');
    const nav_home_sub1_url = document.getElementById('nav_home_sub1_url');
    const nav_home_sub2_label = document.getElementById('nav_home_sub2_label');
    const nav_home_sub2_url = document.getElementById('nav_home_sub2_url');

    const nav_about_label = document.getElementById('nav_about_label');
    const nav_about_sub1_label = document.getElementById('nav_about_sub1_label');
    const nav_about_sub1_url = document.getElementById('nav_about_sub1_url');
    const nav_about_sub2_label = document.getElementById('nav_about_sub2_label');
    const nav_about_sub2_url = document.getElementById('nav_about_sub2_url');

    const nav_services_label = document.getElementById('nav_services_label');
    const nav_services_sub1_label = document.getElementById('nav_services_sub1_label');
    const nav_services_sub1_url = document.getElementById('nav_services_sub1_url');
    const nav_services_sub2_label = document.getElementById('nav_services_sub2_label');
    const nav_services_sub2_url = document.getElementById('nav_services_sub2_url');

    const nav_portfolio_label = document.getElementById('nav_portfolio_label');
    const nav_portfolio_sub1_label = document.getElementById('nav_portfolio_sub1_label');
    const nav_portfolio_sub1_url = document.getElementById('nav_portfolio_sub1_url');
    const nav_portfolio_sub2_label = document.getElementById('nav_portfolio_sub2_label');
    const nav_portfolio_sub2_url = document.getElementById('nav_portfolio_sub2_url');

    const nav_contact_label = document.getElementById('nav_contact_label');
    const nav_contact_sub1_label = document.getElementById('nav_contact_sub1_label');
    const nav_contact_sub1_url = document.getElementById('nav_contact_sub1_url');
    const nav_contact_sub2_label = document.getElementById('nav_contact_sub2_label');
    const nav_contact_sub2_url = document.getElementById('nav_contact_sub2_url');

  // set immediate defaults so buttons show icons before settings load
  toggleIconEl.src = DEFAULT_TOGGLE_ICON;
  settingsIconEl.src = DEFAULT_SETTINGS_ICON;
  toggleIconPreviewImg.src = toggleIconEl.src;
  settingsIconPreviewImg.src = settingsIconEl.src;
  // ensure root has default button style attr
  if(!document.documentElement.hasAttribute('data-button-style')) document.documentElement.setAttribute('data-button-style','default');
  // live preview for theme controls
  if(textColorInput) textColorInput.addEventListener('input', (e) => document.documentElement.style.setProperty('--text', e.target.value));
  if(accentColorInput) accentColorInput.addEventListener('input', (e) => document.documentElement.style.setProperty('--accent', e.target.value));
  if(buttonStyleSelect) buttonStyleSelect.addEventListener('change', (e) => document.documentElement.setAttribute('data-button-style', e.target.value));
  if(fontSelect) fontSelect.addEventListener('change', (e) => {
    const sel = e.target.value || '';
    // if sel already contains comma assume it's a full stack
    if(sel.includes(',')){
      document.body.style.fontFamily = sel;
    } else if(sel){
      // use selected family name with fallback stack
      document.body.style.fontFamily = `"${sel}", Frutiger, 'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif`;
    }
  });
  // language selector removed

    const toggleOpacity = document.getElementById('toggleOpacity');
    const toggleOpacityVal = document.getElementById('toggleOpacityVal');

    function openSettings(){
      settingsPanel.classList.add('open');
      settingsPanel.setAttribute('aria-hidden','false');
      if(settingsBtn) settingsBtn.setAttribute('aria-label', 'Close settings');
    }
    function closeSettingsPanel(){
      settingsPanel.classList.remove('open');
      settingsPanel.setAttribute('aria-hidden','true');
      if(settingsBtn) settingsBtn.setAttribute('aria-label', 'Open settings');
    }

    settingsBtn.addEventListener('click', () => {
      settingsPanel.classList.contains('open') ? closeSettingsPanel() : openSettings();
    });
    closeSettings.addEventListener('click', closeSettingsPanel);
    // top floating close button inside panel
    const settingsCloseTop = document.getElementById('settingsCloseTop');
    if(settingsCloseTop) settingsCloseTop.addEventListener('click', closeSettingsPanel);

    // Load settings from localStorage
    function loadSettings(){
      try{
        const json = localStorage.getItem(STORAGE_KEY);
        if(!json) return;
        const cfg = JSON.parse(json);
        if(cfg){
          if(cfg.background){
            applyBackground(cfg.background);
            // set preview safely (handle spaces in filenames)
            try{ bgPreview.style.backgroundImage = `url("${encodeURI(cfg.background)}")`; }catch(e){ bgPreview.style.backgroundImage = `url(${cfg.background})`; }
            bgUrlInput.value = cfg.background;
          }
          if(cfg.toggleIcon){
            toggleIconEl.src = cfg.toggleIcon;
            toggleIconPreviewImg.src = cfg.toggleIcon;
            toggleIconUrl.value = cfg.toggleIcon;
          } else {
            toggleIconEl.src = DEFAULT_TOGGLE_ICON;
            toggleIconPreviewImg.src = DEFAULT_TOGGLE_ICON;
          }
          if(typeof cfg.toggleOpacity !== 'undefined' && cfg.toggleOpacity !== null){
            const v = parseFloat(cfg.toggleOpacity);
            if(!isNaN(v)){
              document.documentElement.style.setProperty('--toggle-bg-alpha', v);
              toggleOpacity.value = v;
              toggleOpacityVal.textContent = (Math.round(v*100)/100).toFixed(2);
            }
          }
          if(cfg.settingsIcon){
            settingsIconEl.src = cfg.settingsIcon;
            settingsIconPreviewImg.src = cfg.settingsIcon;
            settingsIconUrl.value = cfg.settingsIcon;
          } else {
            settingsIconEl.src = DEFAULT_SETTINGS_ICON;
            settingsIconPreviewImg.src = DEFAULT_SETTINGS_ICON;
          }
          // favicon
          if(cfg.favicon){
            setFavicon(cfg.favicon);
            faviconPreviewImg.src = cfg.favicon;
            faviconUrl.value = cfg.favicon;
          } else {
            setFavicon(DEFAULT_FAVICON);
            faviconPreviewImg.src = DEFAULT_FAVICON;
          }
          // title
          if(cfg.title){
            document.title = cfg.title;
            if(siteTitleInput) siteTitleInput.value = cfg.title;
          } else {
            document.title = INITIAL_TITLE;
            if(siteTitleInput) siteTitleInput.value = INITIAL_TITLE;
          }
          // theme: text color, accent, button style, font
          if(cfg.textColor){
            document.documentElement.style.setProperty('--text', cfg.textColor);
            if(textColorInput) textColorInput.value = cfg.textColor;
          }
          if(cfg.accentColor){
            document.documentElement.style.setProperty('--accent', cfg.accentColor);
            if(accentColorInput) accentColorInput.value = cfg.accentColor;
          }
          if(cfg.buttonStyle){
            document.documentElement.setAttribute('data-button-style', cfg.buttonStyle);
            if(buttonStyleSelect) buttonStyleSelect.value = cfg.buttonStyle;
          }
          if(cfg.font){
            // if cfg.font contains a comma, assume it's a full stack string
            if(cfg.font.indexOf(',') !== -1){
              document.body.style.fontFamily = cfg.font;
              if(fontSelect) fontSelect.value = cfg.font;
            } else {
              // if it's a single family name, use family + fallback stack
              const fallback = `"${cfg.font}", Frutiger, 'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif`;
              document.body.style.fontFamily = fallback;
              if(fontSelect) fontSelect.value = cfg.font;
            }
          }
          // labels
          if(cfg.labels){
            if(lbl_save_label) lbl_save_label.value = cfg.labels.save || '';
            if(lbl_reset_label) lbl_reset_label.value = cfg.labels.reset || '';
            if(lbl_close_label) lbl_close_label.value = cfg.labels.close || '';
            // apply button text
            if(cfg.labels.save && document.getElementById('saveSettings')) document.getElementById('saveSettings').textContent = cfg.labels.save;
            if(cfg.labels.reset && document.getElementById('clearSettings')) document.getElementById('clearSettings').textContent = cfg.labels.reset;
            if(cfg.labels.close && document.getElementById('closeSettings')) document.getElementById('closeSettings').textContent = cfg.labels.close;
          }
          // load nav editor values
          if(cfg.nav){
            try{
              if(cfg.nav.home){ if(nav_home_label) nav_home_label.value = cfg.nav.home.label || ''; if(nav_home_sub1_label) nav_home_sub1_label.value = (cfg.nav.home.subs && cfg.nav.home.subs[0] && cfg.nav.home.subs[0].label) || ''; if(nav_home_sub1_url) nav_home_sub1_url.value = (cfg.nav.home.subs && cfg.nav.home.subs[0] && cfg.nav.home.subs[0].url) || '';
                if(nav_home_sub2_label) nav_home_sub2_label.value = (cfg.nav.home.subs && cfg.nav.home.subs[1] && cfg.nav.home.subs[1].label) || ''; if(nav_home_sub2_url) nav_home_sub2_url.value = (cfg.nav.home.subs && cfg.nav.home.subs[1] && cfg.nav.home.subs[1].url) || ''; }
              if(cfg.nav.about){ if(nav_about_label) nav_about_label.value = cfg.nav.about.label || ''; if(nav_about_sub1_label) nav_about_sub1_label.value = (cfg.nav.about.subs && cfg.nav.about.subs[0] && cfg.nav.about.subs[0].label) || ''; if(nav_about_sub1_url) nav_about_sub1_url.value = (cfg.nav.about.subs && cfg.nav.about.subs[0] && cfg.nav.about.subs[0].url) || '';
                if(nav_about_sub2_label) nav_about_sub2_label.value = (cfg.nav.about.subs && cfg.nav.about.subs[1] && cfg.nav.about.subs[1].label) || ''; if(nav_about_sub2_url) nav_about_sub2_url.value = (cfg.nav.about.subs && cfg.nav.about.subs[1] && cfg.nav.about.subs[1].url) || ''; }
              if(cfg.nav.services){ if(nav_services_label) nav_services_label.value = cfg.nav.services.label || ''; if(nav_services_sub1_label) nav_services_sub1_label.value = (cfg.nav.services.subs && cfg.nav.services.subs[0] && cfg.nav.services.subs[0].label) || ''; if(nav_services_sub1_url) nav_services_sub1_url.value = (cfg.nav.services.subs && cfg.nav.services.subs[0] && cfg.nav.services.subs[0].url) || '';
                if(nav_services_sub2_label) nav_services_sub2_label.value = (cfg.nav.services.subs && cfg.nav.services.subs[1] && cfg.nav.services.subs[1].label) || ''; if(nav_services_sub2_url) nav_services_sub2_url.value = (cfg.nav.services.subs && cfg.nav.services.subs[1] && cfg.nav.services.subs[1].url) || ''; }
              if(cfg.nav.portfolio){ if(nav_portfolio_label) nav_portfolio_label.value = cfg.nav.portfolio.label || ''; if(nav_portfolio_sub1_label) nav_portfolio_sub1_label.value = (cfg.nav.portfolio.subs && cfg.nav.portfolio.subs[0] && cfg.nav.portfolio.subs[0].label) || ''; if(nav_portfolio_sub1_url) nav_portfolio_sub1_url.value = (cfg.nav.portfolio.subs && cfg.nav.portfolio.subs[0] && cfg.nav.portfolio.subs[0].url) || '';
                if(nav_portfolio_sub2_label) nav_portfolio_sub2_label.value = (cfg.nav.portfolio.subs && cfg.nav.portfolio.subs[1] && cfg.nav.portfolio.subs[1].label) || ''; if(nav_portfolio_sub2_url) nav_portfolio_sub2_url.value = (cfg.nav.portfolio.subs && cfg.nav.portfolio.subs[1] && cfg.nav.portfolio.subs[1].url) || ''; }
              if(cfg.nav.contact){ if(nav_contact_label) nav_contact_label.value = cfg.nav.contact.label || ''; if(nav_contact_sub1_label) nav_contact_sub1_label.value = (cfg.nav.contact.subs && cfg.nav.contact.subs[0] && cfg.nav.contact.subs[0].label) || ''; if(nav_contact_sub1_url) nav_contact_sub1_url.value = (cfg.nav.contact.subs && cfg.nav.contact.subs[0] && cfg.nav.contact.subs[0].url) || '';
                if(nav_contact_sub2_label) nav_contact_sub2_label.value = (cfg.nav.contact.subs && cfg.nav.contact.subs[1] && cfg.nav.contact.subs[1].label) || ''; if(nav_contact_sub2_url) nav_contact_sub2_url.value = (cfg.nav.contact.subs && cfg.nav.contact.subs[1] && cfg.nav.contact.subs[1].url) || ''; }
            }catch(e){ console.warn('Failed to apply nav settings to editor', e); }
          }
          // language settings removed
        }
      }catch(e){ console.warn('Failed to load settings', e); }
    }

    function saveSettingsToStorage(cfg){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
    }

    function applyBackground(url){
      function safeBgUrl(u){
        if(!u) return '';
        try{ if(typeof u === 'string' && u.startsWith('data:')) return u; }catch(e){}
        return encodeURI(u);
      }
      if(!url){
        document.body.style.backgroundImage = '';
        document.body.style.backgroundColor = 'var(--bg)';
        document.body.style.backgroundSize = '';
        document.body.style.backgroundPosition = '';
        return;
      }
      const u = safeBgUrl(url);
      document.body.style.backgroundImage = `url("${u}")`;
      document.body.style.backgroundSize = 'cover';
      document.body.style.backgroundPosition = 'center';
      document.body.style.backgroundRepeat = 'no-repeat';
    }

    function setFavicon(href){
      if(!faviconLink) return;
      try{
        console.log('setFavicon:', href);
        // avoid browser cache by adding a cache-busting query when appropriate
        if(!href){
          faviconLink.href = DEFAULT_FAVICON + '?v=' + Date.now();
        } else if(typeof href === 'string' && href.startsWith('data:')){
          // data URLs can be used directly
          faviconLink.href = href;
        } else if(typeof href === 'string'){
          const sep = href.includes('?') ? '&' : '?';
          faviconLink.href = href + sep + 'v=' + Date.now();
        } else {
          faviconLink.href = href;
        }
      }catch(e){ console.warn('Failed to set favicon', e); }
    }

    // Save button: reads URL fields (preferred) or file data URLs for bg and icons
    saveSettings.addEventListener('click', async () => {
      const newCfg = {};

      // background
      let bg = bgUrlInput.value.trim();
      if(!bg && bgFileInput.files && bgFileInput.files[0]){
        const file = bgFileInput.files[0];
        bg = await new Promise((res, rej) => {
          const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file);
        });
      }
      newCfg.background = bg || null;

      // toggle icon
      let tIcon = toggleIconUrl.value.trim();
      if(!tIcon && toggleIconFile.files && toggleIconFile.files[0]){
        const file = toggleIconFile.files[0];
        tIcon = await new Promise((res, rej) => {
          const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file);
        });
      }
  newCfg.toggleIcon = tIcon || null;

  // toggle opacity
  let op = parseFloat(toggleOpacity.value);
  if(isNaN(op)) op = null;
  newCfg.toggleOpacity = (op !== null) ? op : null;

      // settings icon
      let sIcon = settingsIconUrl.value.trim();
      if(!sIcon && settingsIconFile.files && settingsIconFile.files[0]){
        const file = settingsIconFile.files[0];
        sIcon = await new Promise((res, rej) => {
          const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file);
        });
      }
      newCfg.settingsIcon = sIcon || null;

      // favicon
      let fIcon = faviconUrl.value.trim();
      if(!fIcon && faviconFile.files && faviconFile.files[0]){
        const file = faviconFile.files[0];
        fIcon = await new Promise((res, rej) => { const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file); });
      }
      newCfg.favicon = fIcon || null;

      // site title
      const titleVal = siteTitleInput ? siteTitleInput.value.trim() : '';
      newCfg.title = titleVal || null;

      // theme settings
      const textColorVal = textColorInput ? textColorInput.value : null;
      const accentColorVal = accentColorInput ? accentColorInput.value : null;
      const btnStyleVal = buttonStyleSelect ? buttonStyleSelect.value : null;
      const fontVal = fontSelect ? fontSelect.value : null;
      newCfg.textColor = textColorVal || null;
      newCfg.accentColor = accentColorVal || null;
      newCfg.buttonStyle = btnStyleVal || null;
      newCfg.font = fontVal || null;
      // collect nav editor values
      newCfg.nav = {
        home: { label: nav_home_label ? nav_home_label.value.trim() : DEFAULT_NAV.home.label, subs: [
          { label: nav_home_sub1_label ? nav_home_sub1_label.value.trim() : DEFAULT_NAV.home.subs[0].label, url: nav_home_sub1_url ? nav_home_sub1_url.value.trim() : DEFAULT_NAV.home.subs[0].url },
          { label: nav_home_sub2_label ? nav_home_sub2_label.value.trim() : DEFAULT_NAV.home.subs[1].label, url: nav_home_sub2_url ? nav_home_sub2_url.value.trim() : DEFAULT_NAV.home.subs[1].url }
        ] },
        about: { label: nav_about_label ? nav_about_label.value.trim() : DEFAULT_NAV.about.label, subs: [
          { label: nav_about_sub1_label ? nav_about_sub1_label.value.trim() : DEFAULT_NAV.about.subs[0].label, url: nav_about_sub1_url ? nav_about_sub1_url.value.trim() : DEFAULT_NAV.about.subs[0].url },
          { label: nav_about_sub2_label ? nav_about_sub2_label.value.trim() : DEFAULT_NAV.about.subs[1].label, url: nav_about_sub2_url ? nav_about_sub2_url.value.trim() : DEFAULT_NAV.about.subs[1].url }
        ] },
        services: { label: nav_services_label ? nav_services_label.value.trim() : DEFAULT_NAV.services.label, subs: [
          { label: nav_services_sub1_label ? nav_services_sub1_label.value.trim() : DEFAULT_NAV.services.subs[0].label, url: nav_services_sub1_url ? nav_services_sub1_url.value.trim() : DEFAULT_NAV.services.subs[0].url },
          { label: nav_services_sub2_label ? nav_services_sub2_label.value.trim() : DEFAULT_NAV.services.subs[1].label, url: nav_services_sub2_url ? nav_services_sub2_url.value.trim() : DEFAULT_NAV.services.subs[1].url }
        ] },
        portfolio: { label: nav_portfolio_label ? nav_portfolio_label.value.trim() : DEFAULT_NAV.portfolio.label, subs: [
          { label: nav_portfolio_sub1_label ? nav_portfolio_sub1_label.value.trim() : DEFAULT_NAV.portfolio.subs[0].label, url: nav_portfolio_sub1_url ? nav_portfolio_sub1_url.value.trim() : DEFAULT_NAV.portfolio.subs[0].url },
          { label: nav_portfolio_sub2_label ? nav_portfolio_sub2_label.value.trim() : DEFAULT_NAV.portfolio.subs[1].label, url: nav_portfolio_sub2_url ? nav_portfolio_sub2_url.value.trim() : DEFAULT_NAV.portfolio.subs[1].url }
        ] },
        contact: { label: nav_contact_label ? nav_contact_label.value.trim() : DEFAULT_NAV.contact.label, subs: [
          { label: nav_contact_sub1_label ? nav_contact_sub1_label.value.trim() : DEFAULT_NAV.contact.subs[0].label, url: nav_contact_sub1_url ? nav_contact_sub1_url.value.trim() : DEFAULT_NAV.contact.subs[0].url },
          { label: nav_contact_sub2_label ? nav_contact_sub2_label.value.trim() : DEFAULT_NAV.contact.subs[1].label, url: nav_contact_sub2_url ? nav_contact_sub2_url.value.trim() : DEFAULT_NAV.contact.subs[1].url }
        ] }
      };
      // language removed

      // apply theme immediately
      if(textColorVal) document.documentElement.style.setProperty('--text', textColorVal);
      if(accentColorVal) document.documentElement.style.setProperty('--accent', accentColorVal);
      if(btnStyleVal) document.documentElement.setAttribute('data-button-style', btnStyleVal);
      if(fontVal) document.body.style.fontFamily = fontVal;
      // language selection removed

      // labels
      newCfg.labels = {
        save: lbl_save_label ? (lbl_save_label.value.trim() || null) : null,
        reset: lbl_reset_label ? (lbl_reset_label.value.trim() || null) : null,
        close: lbl_close_label ? (lbl_close_label.value.trim() || null) : null,
      };
      if(newCfg.labels.save && document.getElementById('saveSettings')) document.getElementById('saveSettings').textContent = newCfg.labels.save;
      if(newCfg.labels.reset && document.getElementById('clearSettings')) document.getElementById('clearSettings').textContent = newCfg.labels.reset;
      if(newCfg.labels.close && document.getElementById('closeSettings')) document.getElementById('closeSettings').textContent = newCfg.labels.close;

      // apply
      applyBackground(newCfg.background);
      if(newCfg.background){ try{ bgPreview.style.backgroundImage = `url("${encodeURI(newCfg.background)}")`; }catch(e){ bgPreview.style.backgroundImage = `url(${newCfg.background})`; } }
      else { bgPreview.style.backgroundImage = ''; }

  if(newCfg.toggleIcon){ toggleIconEl.src = newCfg.toggleIcon; toggleIconPreviewImg.src = newCfg.toggleIcon; }
  else { toggleIconEl.src = DEFAULT_TOGGLE_ICON; toggleIconPreviewImg.src = DEFAULT_TOGGLE_ICON; }

  if(newCfg.settingsIcon){ settingsIconEl.src = newCfg.settingsIcon; settingsIconPreviewImg.src = newCfg.settingsIcon; }
  else { settingsIconEl.src = DEFAULT_SETTINGS_ICON; settingsIconPreviewImg.src = DEFAULT_SETTINGS_ICON; }

  // apply favicon and title
  if(newCfg.favicon){ setFavicon(newCfg.favicon); faviconPreviewImg.src = newCfg.favicon; faviconUrl.value = newCfg.favicon; }
  else { setFavicon(DEFAULT_FAVICON); faviconPreviewImg.src = DEFAULT_FAVICON; faviconUrl.value = ''; }

  if(newCfg.title){ document.title = newCfg.title; if(siteTitleInput) siteTitleInput.value = newCfg.title; }
  else { document.title = INITIAL_TITLE; if(siteTitleInput) siteTitleInput.value = INITIAL_TITLE; }

      saveSettingsToStorage(newCfg);
      // apply nav labels immediately
      try{ applyLabels(); }catch(e){ console.warn('applyLabels failed', e); }
    });

    // language selector removed

    // Live update for opacity slider
    toggleOpacity.addEventListener('input', () => {
      const v = parseFloat(toggleOpacity.value) || 0;
      document.documentElement.style.setProperty('--toggle-bg-alpha', v);
      toggleOpacityVal.textContent = (Math.round(v*100)/100).toFixed(2);
    });

    // favicon URL live preview
    faviconUrl.addEventListener('input', () => { const v = faviconUrl.value.trim(); faviconPreviewImg.src = v || ''; });
    faviconFile.addEventListener('change', () => { const f = faviconFile.files && faviconFile.files[0]; if(!f){ faviconPreviewImg.removeAttribute('src'); return; } const r = new FileReader(); r.onload = () => { faviconPreviewImg.src = r.result; }; r.readAsDataURL(f); });

    // Clear settings (reset all)
    clearSettings.addEventListener('click', () => {
      bgUrlInput.value = '';
      bgFileInput.value = '';
      toggleIconUrl.value = '';
      toggleIconFile.value = '';
      settingsIconUrl.value = '';
      settingsIconFile.value = '';
      bgPreview.style.backgroundImage = '';
      // restore default icons
      toggleIconEl.src = DEFAULT_TOGGLE_ICON;
      settingsIconEl.src = DEFAULT_SETTINGS_ICON;
      toggleIconPreviewImg.src = DEFAULT_TOGGLE_ICON;
      settingsIconPreviewImg.src = DEFAULT_SETTINGS_ICON;
      // restore favicon & title defaults
      faviconUrl.value = '';
      faviconFile.value = '';
      faviconPreviewImg.src = DEFAULT_FAVICON;
      setFavicon(DEFAULT_FAVICON);
      if(siteTitleInput) siteTitleInput.value = INITIAL_TITLE;
      document.title = INITIAL_TITLE;
      applyBackground(null);
      // reset opacity to default
      document.documentElement.style.setProperty('--toggle-bg-alpha', 0.03);
      if(toggleOpacity){ toggleOpacity.value = 0.03; toggleOpacityVal.textContent = '0.03'; }
      // reset theme to defaults
      document.documentElement.style.setProperty('--text', '#0f172a');
      document.documentElement.style.setProperty('--accent', '#111827');
      document.documentElement.setAttribute('data-button-style','default');
      document.body.style.fontFamily = "Frutiger, 'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif";
      if(textColorInput) textColorInput.value = '#0f172a';
      if(accentColorInput) accentColorInput.value = '#111827';
      if(buttonStyleSelect) buttonStyleSelect.value = 'default';
      if(fontSelect) fontSelect.value = "Frutiger, 'Source Sans 3', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial";
      // Reset nav editor to defaults
      try{
        if(nav_home_label) nav_home_label.value = DEFAULT_NAV.home.label; if(nav_home_sub1_label) nav_home_sub1_label.value = DEFAULT_NAV.home.subs[0].label; if(nav_home_sub1_url) nav_home_sub1_url.value = DEFAULT_NAV.home.subs[0].url; if(nav_home_sub2_label) nav_home_sub2_label.value = DEFAULT_NAV.home.subs[1].label; if(nav_home_sub2_url) nav_home_sub2_url.value = DEFAULT_NAV.home.subs[1].url;
        if(nav_about_label) nav_about_label.value = DEFAULT_NAV.about.label; if(nav_about_sub1_label) nav_about_sub1_label.value = DEFAULT_NAV.about.subs[0].label; if(nav_about_sub1_url) nav_about_sub1_url.value = DEFAULT_NAV.about.subs[0].url; if(nav_about_sub2_label) nav_about_sub2_label.value = DEFAULT_NAV.about.subs[1].label; if(nav_about_sub2_url) nav_about_sub2_url.value = DEFAULT_NAV.about.subs[1].url;
        if(nav_services_label) nav_services_label.value = DEFAULT_NAV.services.label; if(nav_services_sub1_label) nav_services_sub1_label.value = DEFAULT_NAV.services.subs[0].label; if(nav_services_sub1_url) nav_services_sub1_url.value = DEFAULT_NAV.services.subs[0].url; if(nav_services_sub2_label) nav_services_sub2_label.value = DEFAULT_NAV.services.subs[1].label; if(nav_services_sub2_url) nav_services_sub2_url.value = DEFAULT_NAV.services.subs[1].url;
        if(nav_portfolio_label) nav_portfolio_label.value = DEFAULT_NAV.portfolio.label; if(nav_portfolio_sub1_label) nav_portfolio_sub1_label.value = DEFAULT_NAV.portfolio.subs[0].label; if(nav_portfolio_sub1_url) nav_portfolio_sub1_url.value = DEFAULT_NAV.portfolio.subs[0].url; if(nav_portfolio_sub2_label) nav_portfolio_sub2_label.value = DEFAULT_NAV.portfolio.subs[1].label; if(nav_portfolio_sub2_url) nav_portfolio_sub2_url.value = DEFAULT_NAV.portfolio.subs[1].url;
        if(nav_contact_label) nav_contact_label.value = DEFAULT_NAV.contact.label; if(nav_contact_sub1_label) nav_contact_sub1_label.value = DEFAULT_NAV.contact.subs[0].label; if(nav_contact_sub1_url) nav_contact_sub1_url.value = DEFAULT_NAV.contact.subs[0].url; if(nav_contact_sub2_label) nav_contact_sub2_label.value = DEFAULT_NAV.contact.subs[1].label; if(nav_contact_sub2_url) nav_contact_sub2_url.value = DEFAULT_NAV.contact.subs[1].url;
      }catch(e){ }
      // Reset label editor values
      if(lbl_save_label) lbl_save_label.value = 'Save';
      if(lbl_reset_label) lbl_reset_label.value = 'Reset';
      if(lbl_close_label) lbl_close_label.value = 'Close';
      // Reset button text
      if(document.getElementById('saveSettings')) document.getElementById('saveSettings').textContent = 'Save';
      if(document.getElementById('clearSettings')) document.getElementById('clearSettings').textContent = 'Reset';
      if(document.getElementById('closeSettings')) document.getElementById('closeSettings').textContent = 'Close';
      localStorage.removeItem(STORAGE_KEY);
      // reapply defaults to DOM
      try{ applyLabels(); }catch(e){}
    });

    // translations removed


    // Live preview when entering URL
    bgUrlInput.addEventListener('input', () => {
      const v = bgUrlInput.value.trim();
      if(v){ try{ bgPreview.style.backgroundImage = `url("${encodeURI(v)}")`; }catch(e){ bgPreview.style.backgroundImage = `url(${v})`; } }
      else { bgPreview.style.backgroundImage = ''; }
    });

    // Icon URL previews
    toggleIconUrl.addEventListener('input', () => { const v = toggleIconUrl.value.trim(); toggleIconPreviewImg.src = v || ''; });
    settingsIconUrl.addEventListener('input', () => { const v = settingsIconUrl.value.trim(); settingsIconPreviewImg.src = v || ''; });

    // Live preview when selecting file
    bgFileInput.addEventListener('change', () => {
      const f = bgFileInput.files && bgFileInput.files[0];
      if(!f){ bgPreview.style.backgroundImage = ''; return; }
      const r = new FileReader(); r.onload = () => { bgPreview.style.backgroundImage = `url(${r.result})`; }; r.readAsDataURL(f);
    });

    // Icon file previews
    toggleIconFile.addEventListener('change', () => {
      const f = toggleIconFile.files && toggleIconFile.files[0];
      if(!f){ toggleIconPreviewImg.removeAttribute('src'); return; }
      const r = new FileReader(); r.onload = () => { toggleIconPreviewImg.src = r.result; }; r.readAsDataURL(f);
    });
    settingsIconFile.addEventListener('change', () => {
      const f = settingsIconFile.files && settingsIconFile.files[0];
      if(!f){ settingsIconPreviewImg.removeAttribute('src'); return; }
      const r = new FileReader(); r.onload = () => { settingsIconPreviewImg.src = r.result; }; r.readAsDataURL(f);
    });

    // title presets loading
    async function loadTitlePresets(){
      try{
        const res = await fetch('/assets/titlepresets.txt');
        if(!res.ok) return;
        const txt = await res.text();
        const lines = txt.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
        const container = document.getElementById('titlePresets');
        if(!container) return;
        lines.forEach(t => {
          const b = document.createElement('button');
          b.className = 'btn'; b.style.padding = '6px'; b.textContent = t; b.title = t;
          b.addEventListener('click', () => { if(siteTitleInput) siteTitleInput.value = t; document.title = t; });
          container.appendChild(b);
        });
      }catch(e){ console.error('Error loading title presets:', e); }
    }
    // Load icon presets from manifest (if present)
    async function loadPresets(){
      try{
        const res = await fetch('/assets/icons/manifest.json');
        if(!res.ok) return;
        const data = await res.json();
        // if manifest provides defaults, prefer them
        if(data.menu && Array.isArray(data.menu) && data.menu.length){
          DEFAULT_TOGGLE_ICON = data.menu[0];
        }
        if(data.setting && Array.isArray(data.setting) && data.setting.length){
          DEFAULT_SETTINGS_ICON = data.setting[0];
        }
        if(data.favicon && Array.isArray(data.favicon) && data.favicon.length){
          DEFAULT_FAVICON = data.favicon[0];
        }
        // apply immediate defaults to previews/UI so loadSettings (which runs after) has sensible defaults
        if(toggleIconEl) { toggleIconEl.src = DEFAULT_TOGGLE_ICON; toggleIconPreviewImg.src = DEFAULT_TOGGLE_ICON; }
        if(settingsIconEl) { settingsIconEl.src = DEFAULT_SETTINGS_ICON; settingsIconPreviewImg.src = DEFAULT_SETTINGS_ICON; }
        if(faviconPreviewImg) { faviconPreviewImg.src = DEFAULT_FAVICON; }
        setFavicon(DEFAULT_FAVICON);
        // menu
        const menuContainer = document.getElementById('menuPresets');
        if(data.menu && Array.isArray(data.menu) && menuContainer){
          data.menu.forEach(src => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.style.padding = '6px';
            btn.style.display = 'flex';
            btn.style.alignItems = 'center';
            btn.style.justifyContent = 'center';
            btn.style.width = '48px';
            btn.style.height = '48px';
            btn.title = src;
            const img = document.createElement('img');
            img.src = src;
            img.style.width = '100%'; img.style.height = '100%'; img.style.objectFit = 'cover';
            btn.appendChild(img);
            btn.addEventListener('click', () => {
              toggleIconUrl.value = src; toggleIconPreviewImg.src = src; toggleIconEl.src = src;
            });
            menuContainer.appendChild(btn);
          });
        }

        // settings
        const settingsContainer = document.getElementById('settingsPresets');
        if(data.setting && Array.isArray(data.setting) && settingsContainer){
          data.setting.forEach(src => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.style.padding = '6px';
            btn.style.display = 'flex';
            btn.style.alignItems = 'center';
            btn.style.justifyContent = 'center';
            btn.style.width = '48px';
            btn.style.height = '48px';
            btn.title = src;
            const img = document.createElement('img');
            img.src = src;
            img.style.width = '100%'; img.style.height = '100%'; img.style.objectFit = 'cover';
            btn.appendChild(img);
            btn.addEventListener('click', () => {
              settingsIconUrl.value = src; settingsIconPreviewImg.src = src; settingsIconEl.src = src;
            });
            settingsContainer.appendChild(btn);
          });
        }
          // favicon presets
          const favContainer = document.getElementById('faviconPresets');
          if(data.favicon && Array.isArray(data.favicon) && favContainer){
            data.favicon.forEach(src => {
              const btn = document.createElement('button');
              btn.className = 'btn'; btn.style.padding = '6px'; btn.style.width = '36px'; btn.style.height = '36px';
              const img = document.createElement('img'); img.src = src; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
              btn.appendChild(img);
              btn.addEventListener('click', () => { console.log('favicon preset clicked:', src); faviconUrl.value = src; faviconPreviewImg.src = src; setFavicon(src); });
              favContainer.appendChild(btn);
            });
          }
          // background presets
          const bgContainer = document.getElementById('bgPresets');
          if(data.background && Array.isArray(data.background) && bgContainer){
            data.background.forEach(src => {
              const btn = document.createElement('button');
              btn.className = 'btn'; btn.style.padding = '6px'; btn.style.width = '72px'; btn.style.height = '48px';
              btn.title = src;
              const img = document.createElement('img'); img.src = src;
              img.style.width = '100%'; img.style.height = '100%'; img.style.objectFit = 'cover';
              btn.appendChild(img);
              btn.addEventListener('click', () => {
                console.log('background preset clicked:', src);
                // apply as background and update preview/input
                bgUrlInput.value = src;
                try{ bgPreview.style.backgroundImage = `url("${encodeURI(src)}")`; }catch(e){ bgPreview.style.backgroundImage = `url(${src})`; }
                applyBackground(src);
              });
              bgContainer.appendChild(btn);
            });
          }
      }catch(e){ console.error('Error loading presets:', e); }
    }

      // --- Font manifest loading: load available font files from /fonts/manifest.json (fallback to assets/fonts/manifest.json)
      function getFontFormat(ext){
        const e = ext.toLowerCase().replace(/^[.]/,'');
        switch(e){
          case 'woff2': return 'woff2';
          case 'woff': return 'woff';
          case 'ttf': return 'truetype';
          case 'otf': return 'opentype';
          case 'svg': return 'svg';
          case 'eot': return 'embedded-opentype';
          default: return '';
        }
      }

      function prettyNameFromFilename(filename){
        // strip path and extension
        const base = filename.split('/').pop().replace(/\.[^.]+$/, '');
        // replace non-alphanumeric with space and trim
        return base.replace(/[_\-]/g, ' ').replace(/\s+/g,' ').trim();
      }

      function registerFontFamilyFromFiles(familyName, fileList){
        // build src string sorted by preferred order (woff2, woff, ttf, otf, svg, eot)
        const order = ['woff2','woff','ttf','otf','svg','eot'];
        const sources = [];
        order.forEach(ext => {
          fileList.forEach(f => {
            if(f.toLowerCase().endsWith('.' + ext)){
              const fmt = getFontFormat(ext);
              const url = f;
              sources.push(`url(\"${url}\")${fmt ? ' format(\"' + fmt + '\")' : ''}`);
            }
          });
        });
        if(!sources.length) return;
        const css = `@font-face{font-family:"${familyName}";src:${sources.join(',')};font-display:swap;}`;
        const style = document.createElement('style'); style.textContent = css; document.head.appendChild(style);
      }

      async function loadFontsManifest(){
        const pathsToTry = ['/fonts/manifest.json', '/assets/fonts/manifest.json'];
        let data = null;
        for(const p of pathsToTry){
          try{
            const res = await fetch(p);
            if(!res.ok) continue;
            data = await res.json();
            break;
          }catch(e){ /* try next */ }
        }
        if(!data || !Array.isArray(data)) return;
        // group by base filename without extension
        const groups = {};
        data.forEach(src => {
          const base = src.split('/').pop().replace(/\.[^.]+$/, '');
          if(!groups[base]) groups[base] = [];
          groups[base].push(src);
        });
        // empty existing fontSelect options except placeholder
        const select = document.getElementById('fontSelect');
        if(!select) return;
        // keep the first options (the built-in choices), then append
        const existing = Array.from(select.options).slice(0);
        // Add each group as a new font family
        Object.keys(groups).forEach(base => {
          const files = groups[base];
          const familyName = prettyNameFromFilename(base);
          // register @font-face with file list
          registerFontFamilyFromFiles(familyName, files);
          // add option to select if not already present
          const existingOption = Array.from(select.options).find(o => o.value === familyName);
          if(!existingOption){
            const opt = document.createElement('option');
            opt.value = familyName;
            opt.textContent = familyName;
            select.appendChild(opt);
          }
        });
      }
  // load presets and settings
  // translation code removed

  // initialize presets and settings
  (async function init(){
    await loadPresets().then(() => { loadTitlePresets(); }).catch((e) => { console.error('Preset loading failed:', e); loadTitlePresets(); });
    await loadFontsManifest();
    await loadSettings();
    applyLabels();
  })();
  </script>
</body>
</html>